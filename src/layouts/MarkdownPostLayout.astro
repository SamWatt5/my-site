---
import BaseLayout from "./BaseLayout.astro";
const { frontmatter } = Astro.props;

// Format the date nicely
let publishDate = "Unknown Date";
try {
    const dateObj = frontmatter.date instanceof Date ? frontmatter.date : new Date(frontmatter.date);

    if (!isNaN(dateObj.getTime())) {
        publishDate = dateObj.toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric",
        });
    }
} catch (error) {
    console.warn("Invalid date format:", frontmatter.date);
}

// Estimate reading time from content
const wordsPerMinute = 200;
const content = await Astro.slots.render("default");
const wordCount = content
    .replace(/<[^>]*>/g, "")
    .split(/\s+/)
    .filter((word: string) => word.length > 0).length;
const readingTime = Math.max(1, Math.ceil(wordCount / wordsPerMinute));
---

<BaseLayout pageTitle={frontmatter.title}>
    <!-- Blog Post Header -->
    <article class="max-w-4xl mx-auto px-6 py-12">
        <!-- Back Navigation -->
        <div class="mb-8">
            <a href="/blog" class="inline-flex items-center text-primary-500 hover:text-primary-600 transition-colors duration-300 font-medium">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                Back to Blog
            </a>
        </div>

        <!-- Post Header -->
        <header class="mb-12 text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-gray-100 mb-6 leading-tight">
                {frontmatter.title}
            </h1>

            {frontmatter.description && <p class="text-xl text-gray-600 dark:text-gray-400 mb-8 leading-relaxed max-w-3xl mx-auto">{frontmatter.description}</p>}

            <!-- Post Meta -->
            <div class="flex flex-wrap items-center justify-center gap-6 text-gray-500 dark:text-gray-400 mb-8">
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <span>By {frontmatter.author}</span>
                </div>

                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <span>{publishDate}</span>
                </div>

                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>{readingTime} min read</span>
                </div>
            </div>

            <!-- Tags -->
            {
                frontmatter.tags && (
                    <div class="flex flex-wrap justify-center gap-2 mb-8">
                        {frontmatter.tags.map((tag: string) => (
                            <a href={`/tags/${tag}`} class="px-4 py-2 bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 rounded-full text-sm font-medium hover:bg-primary-200 dark:hover:bg-primary-900/50 transition-colors duration-300">
                                #{tag}
                            </a>
                        ))}
                    </div>
                )
            }

            <!-- Divider -->
            <div class="w-24 h-1 bg-gradient-to-r from-primary-500 to-accent-500 mx-auto rounded-full"></div>
        </header>

        <!-- Blog Content -->
        <div
            class="prose prose-lg prose-gray dark:prose-invert max-w-none
                    prose-headings:font-bold prose-headings:text-gray-900 dark:prose-headings:text-gray-100
                    prose-h1:text-3xl prose-h1:mt-12 prose-h1:mb-6
                    prose-h2:text-2xl prose-h2:mt-10 prose-h2:mb-4 prose-h2:text-primary-600 dark:prose-h2:text-primary-400
                    prose-h3:text-xl prose-h3:mt-8 prose-h3:mb-3
                    prose-p:text-gray-700 dark:prose-p:text-gray-300 prose-p:leading-relaxed prose-p:mb-6
                    prose-a:text-primary-500 prose-a:no-underline hover:prose-a:text-primary-600 hover:prose-a:underline
                    prose-strong:text-gray-900 dark:prose-strong:text-gray-100 prose-strong:font-semibold
                    prose-code:text-primary-600 dark:prose-code:text-primary-400 prose-code:bg-gray-100 dark:prose-code:bg-gray-800 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:font-mono prose-code:text-sm
                    prose-pre:bg-gray-900 dark:prose-pre:bg-gray-950 prose-pre:border prose-pre:border-gray-200 dark:prose-pre:border-gray-700
                    prose-blockquote:border-l-4 prose-blockquote:border-primary-300 prose-blockquote:bg-primary-50 dark:prose-blockquote:bg-primary-900/20 prose-blockquote:pl-6 prose-blockquote:py-2 prose-blockquote:my-6
                    prose-ul:my-6 prose-li:my-2
                    prose-img:rounded-xl prose-img:shadow-lg prose-img:my-8"
        >
            <slot />
        </div>

        <!-- Post Footer -->
        <footer class="mt-16 pt-8 border-t border-gray-200 dark:border-gray-700">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-6">
                <div class="text-center sm:text-left">
                    <p class="text-gray-600 dark:text-gray-400 mb-2">Thanks for reading! Found this helpful?</p>
                    <div class="flex items-center gap-4">
                        <a href="/blog" class="text-primary-500 hover:text-primary-600 font-medium transition-colors duration-300"> ‚Üê More Posts </a>
                        <a href="/about" class="text-primary-500 hover:text-primary-600 font-medium transition-colors duration-300"> About Me ‚Üí </a>
                    </div>
                </div>

                <div class="text-center sm:text-right">
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">Share this post</p>
                    <div class="flex items-center gap-3">
                        <a href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(frontmatter.title)}&url=${encodeURIComponent(Astro.url.href)}`} class="w-8 h-8 bg-blue-500 hover:bg-blue-600 text-white rounded-full flex items-center justify-center transition-colors duration-300" target="_blank" rel="noopener noreferrer"> ùïè </a>
                        <a href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(Astro.url.href)}`} class="w-8 h-8 bg-blue-700 hover:bg-blue-800 text-white rounded-full flex items-center justify-center transition-colors duration-300" target="_blank" rel="noopener noreferrer"> in </a>
                    </div>
                </div>
            </div>
        </footer>
    </article>
</BaseLayout>
